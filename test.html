<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebRTC Test Local</title>
</head>
<body>
  <video id="local" autoplay muted playsinline width="300" height="200"></video>
  <video id="remote" autoplay playsinline width="300" height="200"></video>
  <button id="start">Lancer</button>

  <script>
    let localVideo = document.getElementById("local");
    let remoteVideo = document.getElementById("remote");
    let startBtn = document.getElementById("start");

    let localStream, pc1, pc2;

    const config = {
      iceServers: [
        { urls: "stun:stun.l.google.com:19302" },
        {
          urls: "turn:openrelay.metered.ca:80",
          username: "openai",
          credential: "openai"
        }
      ]
    };

    startBtn.onclick = async () => {
      localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      localVideo.srcObject = localStream;

      pc1 = new RTCPeerConnection(config);
      pc2 = new RTCPeerConnection(config);

      pc1.onicecandidate = e => e.candidate && pc2.addIceCandidate(e.candidate);
      pc2.onicecandidate = e => e.candidate && pc1.addIceCandidate(e.candidate);

      pc2.ontrack = e => {
        remoteVideo.srcObject = e.streams[0];
      };

      localStream.getTracks().forEach(track => pc1.addTrack(track, localStream));

      const offer = await pc1.createOffer();
      await pc1.setLocalDescription(offer);
      await pc2.setRemoteDescription(offer);

      const answer = await pc2.createAnswer();
      await pc2.setLocalDescription(answer);
      await pc1.setRemoteDescription(answer);
    };
  </script>
</body>
</html>
